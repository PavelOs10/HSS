{% extends 'main/base.html' %} {% load static %} {% block title %}Новости{% endblock %} {% block head %}
<link href="{% static 'css/news.css' %}" rel="stylesheet">
<style>
    .modal .navbar {
        display: none !important;
    }
    
    .modal-content {
        border: none !important;
        background: transparent !important;
    }
    
    .modal-body {
        padding: 0 !important;
    }
    
    .news-modal-content {
        background: rgba(255, 255, 255, 0.98);
        border-radius: 15px;
        padding: 30px;
    }
    
    .news-modal-image {
        width: 100%;
        height: auto;
        max-height: 70vh;
        object-fit: contain;
        /* Изменено с cover на contain */
        border-radius: 10px;
    }
    
    .news-image {
        height: 250px;
        object-fit: cover;
        /* Для списка новостей сохраняем обрезку */
        width: 100%;
    }
</style>
{% endblock %} {% block content %}
<div class="container my-3 pt-3" style="margin-top: -1.5cm;">
    <h2 class="text-center mb-4 title-animate">Новости</h2>
    <div class="row">
        {% for news_item in news %}
        <div class="col-12 mb-4">
            <div class="card news-card" data-id="{{ news_item.id }}">
                <div class="row g-0">
                    <div class="col-md-4">
                        <img src="{{ news_item.image.url }}" class="img-fluid news-image" alt="{{ news_item.title }}">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h3 class="card-title">{{ news_item.title }}</h3>
                            <p class="card-text">{{ news_item.content|truncatechars:200 }}</p>
                        </div>
                        <div class="card-footer bg-transparent">
                            <small class="text-muted news-date">
                                {{ news_item.created_at|date:"d.m.Y H:i" }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Модальное окно -->
<div class="modal fade" id="newsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-body">
                <div class="news-modal-content">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <img id="modalNewsImage" class="news-modal-image w-100">
                        </div>
                        <div class="col-md-6 ps-md-4">
                            <h2 id="modalNewsTitle" class="mb-3"></h2>
                            <div id="modalNewsContent" class="mb-3"></div>
                            <div class="text-muted">
                                <small id="modalNewsDate"></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} {% block scripts %}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll('.news-card').forEach(card => {
            card.addEventListener('click', async function() {
                try {
                    const newsId = this.dataset.id;
                    const response = await fetch(`/news/${newsId}/`);

                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                    const html = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');

                    // Обновляем модальное окно
                    document.getElementById('modalNewsTitle').textContent =
                        doc.querySelector('.card-title').textContent;
                    document.getElementById('modalNewsContent').innerHTML =
                        doc.querySelector('.card-text').innerHTML;
                    document.getElementById('modalNewsDate').textContent =
                        doc.querySelector('.text-muted small').textContent;

                    // Загрузка изображения с обработкой ошибок
                    const img = new Image();
                    img.src = doc.querySelector('img').src;
                    img.onload = () => {
                        document.getElementById('modalNewsImage').src = img.src;
                        new bootstrap.Modal(document.getElementById('newsModal')).show();
                    };
                    img.onerror = () => {
                        document.getElementById('modalNewsImage').src = '{% static "img/placeholder.jpg" %}';
                        new bootstrap.Modal(document.getElementById('newsModal')).show();
                    };

                } catch (error) {
                    console.error('Error:', error);
                    // Автоматическое открытие модального окна даже при ошибке
                    new bootstrap.Modal(document.getElementById('newsModal')).show();
                }
            });
        });
    });
</script>
{% endblock %}